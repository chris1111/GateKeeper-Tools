#!/bin/bash
# script GateKeeper Tools
# (c) Copyright 2024 chris1111

nameh=`users`
function echob() {
  echo "`tput bold`$1`tput sgr0`"
}
function head
{
clear

echo "            = = = = = = = = = = = = = = = = = = = = = = = = =  "

tput blink                    
echo "                               GateKeeper Tools"  
tput sgr0
echo "                       Fonctionne de 10.15 a macOS 15"
echo "            = = = = = = = = = = = = = = = = = = = = = = = = =  "
}
function menu
{
echo "                       Bienvenue "`tput setaf 7``tput sgr0``tput bold``tput setaf 26`$nameh`tput sgr0` `tput setaf 7``tput sgr0`" GateKeeper Tools"
echo " "
echo "                                `tput setaf 26`Credit: Apple"
echo " "
echo "                        
                 `tput setaf 7``tput sgr0``tput bold``tput setaf 26`Taper: ⬇`tput sgr0` `tput setaf 7``tput sgr0`︎"
echo "               =========================================== "
echo "                     ✅  1 = `tput setaf 7``tput sgr0``tput bold``tput setaf 26`Désactiver GateKeeper`tput sgr0` `tput setaf 7``tput sgr0`"
echo "               =========================================== "
echo "                     ✅  2 = `tput setaf 7``tput sgr0``tput bold``tput setaf 26`Activer GateKeeper`tput sgr0` `tput setaf 7``tput sgr0`"  
echo "               =========================================== "
echo "                     ✅  3 = `tput setaf 7``tput sgr0``tput bold``tput setaf 26`Vérifier le Status`tput sgr0` `tput setaf 7``tput sgr0`"  
echo "               =========================================== "
echo "                     ❎  X = `tput setaf 7``tput sgr0``tput bold``tput setaf 26`Quitter (Sortir)`tput sgr0` `tput setaf 7``tput sgr0`" 
echo "               =========================================== "

echo "            = = = = = = = = = = = = = = = = = = = = = = = = =  "

tput blink                    
echo "                              GateKeeper Tools" 
tput sgr0

echo "            = = = = = = = = = = = = = = = = = = = = = = = = =  "

read -n 1 option
}
function DISABLE
{
head
echo " "
macOSVersion=$(/usr/bin/sw_vers | grep "ProductVersion" | /usr/bin/awk '{ print $2 }')
echo "Désactiver GateKeeper"
echo "De macOS $macOSVersion"
if [[ $macOSVersion = 15.* ]]; then    
  printf -- '%s\n' "Ce Mac exécute macOS Sequoia." 
  printf -- '%s\n' "Insérez votre mot de passe pour continuer." 
  sudo spctl --global-disable
  echo " "
  echo "La désactivation globale du système d’évaluation doit être confirmée dans les paramètres système."
  echo " "
  echo "GateKeeper Désactiver"
elif [[ $macOSVersion = 14.* ]]; then 
  printf -- '%s\n' "Ce Mac exécute macOS Sonoma." 
  printf -- '%s\n' "Insérez votre mot de passe pour continuer." 
  sudo spctl --master-disable
  echo ""
  echo "GateKeeper Désactiver"
else
  printf -- '%s\n' "Ce Mac exécute un macOS antérieur à Sonoma."
  printf -- '%s\n' "Insérez votre mot de passe pour continuer." 
  sudo spctl --master-disable
  echo ""
  echo "GateKeeper Désactiver"
fi
echo " "
}
function ENABLE
{
head
echo " "
macOSVersion=$(/usr/bin/sw_vers | grep "ProductVersion" | /usr/bin/awk '{ print $2 }')
echo "Enable GateKeeper"
echo "De macOS $macOSVersion"
if [[ $macOSVersion = 15.* ]]; then    
  printf -- '%s\n' "Ce Mac exécute macOS Sequoia." 
  printf -- '%s\n' "Insérez votre mot de passe pour continuer." 
  spctl --status
  sudo spctl --disable-status
  echo ""
  echo "GateKeeper Activer"
  echo ""
  echo "L'activation globale du système doit être confirmée dans les paramètres système.
Vous devez choisir une de vos deux Options d'activations; cela prendras effet aux prochain redémarrage du système."
  echo "(L'Option de n'importe ou ne seras plus disponible)"
elif [[ $macOSVersion = 14.* ]]; then 
  printf -- '%s\n' "Ce Mac exécute macOS Sonoma." 
  printf -- '%s\n' "Insérez votre mot de passe pour continuer." 
  sudo spctl --master-enable
  echo ""
  echo "GateKeeper Activer"
else
  printf -- '%s\n' "Ce Mac exécute un macOS antérieur à Sonoma."
  printf -- '%s\n' "Insérez votre mot de passe pour continuer." 
  sudo spctl --master-enable
  echo ""
  echo "GateKeeper Activer"
fi
echo " "
}
function STATUS
{
head
echo " "
macOSVersion=$(/usr/bin/sw_vers | grep "ProductVersion" | /usr/bin/awk '{ print $2 }')
echo "Vérifier Status"
echo "De macOS $macOSVersion"
if [[ $macOSVersion = 15.* ]]; then    
  printf -- '%s\n' "Ce Mac exécute macOS Sequoia." 
  spctl --status
  echo ""
  echo "Status Vérifier"
elif [[ $macOSVersion = 14.* ]]; then 
  printf -- '%s\n' "Ce Mac exécute macOS Sonoma." 
  spctl --status
  echo ""
  echo "Status Vérifier"
else
  printf -- '%s\n' "Ce Mac exécute un macOS antérieur à Sonoma."
  spctl --status
  echo ""
  echo "Status Vérifier"
fi
echo " "
}
function Quit
{
clear
echo " " 
echo "
Quitter GateKeeper Tools"
echo " "
osascript -e 'tell app "Terminal" to display dialog "
Quitter GateKeeper Tools" with icon file "System:Library:CoreServices:Finder.app:Contents:Resources:Finder.icns" buttons {"Sortir"} default button 1 with title " GateKeeper Tools"'

echo " "
say Merci dutiliser GateKeeper Tools!
echob "Merci`tput setaf 7``tput sgr0``tput bold``tput setaf 26` $nameh `tput sgr0` `tput setaf 7``tput sgr0`dutiliser GateKeeper Tools"

exit 123456

}
while [ 1 ]
do
head
menu
case $option in

1|1)
echo
DISABLE ;;
2|2)
echo
ENABLE ;;
3|3)
echo
STATUS ;;
x|X)
echo
Quit ;;

*)
echo ""
esac
echo
echob "`tput setaf 7``tput sgr0``tput bold``tput setaf 26`Appuyez sur une touche pour revenir au menu`tput sgr0` `tput setaf 7``tput sgr0`"
echo
read -n 1 line
clear
done

exit
